package vn.softech.dao;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.apache.log4j.Logger;
import org.hibernate.Criteria;
import org.hibernate.Query;
import org.hibernate.criterion.Order;
import org.hibernate.criterion.Restrictions;

import vn.softech.hibernate.TblBmdt;
import vn.softech.hibernate.TblCongDan;
import vn.softech.hibernate.TblDocument;
import vn.softech.hibernate.TblToChuc;
import vn.softech.hibernate.TblTtcgcndkmsxdcb;
import vn.softech.hibernate.TblTtcgcndkmsxdcbButPhe;
import vn.softech.hibernate.TblTtcgcndkmsxdcbChuyenhs;
import vn.softech.hibernate.TblTtcgcndkmsxdcbDinhKem;
import vn.softech.hibernate.TblTtcmsdvsdns;
import vn.softech.hibernate.TblTtcmsdvsdnsButPhe;
import vn.softech.hibernate.TblTtcmsdvsdnsChuyenhs;
import vn.softech.hibernate.TblTtcmsdvsdnsDinhKem;
import vn.softech.hibernate.TblTtpapbdtns;
import vn.softech.hibernate.TblTtpapbdtnsButPhe;
import vn.softech.hibernate.TblTtpapbdtnsChuyenhs;
import vn.softech.hibernate.TblTtpapbdtnsDinhKem;
import vn.softech.hibernate.TblTtpdgmsts;
import vn.softech.hibernate.TblTtpdgmstsButPhe;
import vn.softech.hibernate.TblTtpdgmstsChuyenhs;
import vn.softech.hibernate.TblTtpdgmstsDinhKem;

public class PublicDichVuCongDao {
	private static Logger log = Logger.getLogger(PublicDichVuCongDao.class);
	
	public Long save(TblDocument document) {
		log.debug("Call save TblCongDan");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(document);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblCongDan", e);
		}
		return returnId;
	}
	
	public Long save(TblToChuc object) {
		log.debug("Call save TblToChuc");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblToChuc", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcgcndkmsxdcb object) {
		log.debug("Call save TblTtcgcndkmsxdcb");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcgcndkmsxdcb", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcgcndkmsxdcbButPhe object) {
		log.debug("Call save TblTtcgcndkmsxdcbButPhe");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcgcndkmsxdcbButPhe", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcgcndkmsxdcbChuyenhs object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcgcndkmsxdcbChuyenhs", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcgcndkmsxdcbDinhKem object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcgcndkmsxdcbChuyenhs", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcmsdvsdns object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcgcndkmsxdcbChuyenhs", e);
		}
		return returnId;
	}
	
	public Long save(TblTtcmsdvsdnsButPhe object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsButPhe", e);
		}
		return returnId;
	}
	public Long save(TblTtcmsdvsdnsChuyenhs object) {
		log.debug("Call save TblTtcmsdvsdnsChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsChuyenhs", e);
		}
		return returnId;
	}
	public Long save(TblTtcmsdvsdnsDinhKem object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsDinhKem", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpapbdtns object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsDinhKem", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpapbdtnsButPhe object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsDinhKem", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpapbdtnsChuyenhs object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsDinhKem", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpapbdtnsDinhKem object) {
		log.debug("Call save TblTtcgcndkmsxdcbChuyenhs");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtcmsdvsdnsDinhKem", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpdgmsts object) {
		log.debug("Call save TblTtpdgmsts");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtpdgmsts", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpdgmstsButPhe object) {
		log.debug("Call save TblTtpdgmsts");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtpdgmsts", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpdgmstsChuyenhs object) {
		log.debug("Call save TblTtpdgmsts");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtpdgmsts", e);
		}
		return returnId;
	}
	
	public Long save(TblTtpdgmstsDinhKem object) {
		log.debug("Call save TblTtpdgmsts");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblTtpdgmsts", e);
		}
		return returnId;
	}
	//====================================================================================
	/**
	 * DVC Cong dan
	 */
	public List<TblCongDan> getDVCCongDan() {
		log.debug("Call get List<TblCongDan>");
		List<TblCongDan> list = new ArrayList<TblCongDan>();		
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblCongDan.class);
			criteria.add(Restrictions.eq("status", (byte)1));
			criteria.addOrder(Order.desc("modified"));
			list = criteria.list();
		} catch (RuntimeException re) {
			log.error("get List<TblCongDan> failed", re);
		}
		return list;
	}
	public TblCongDan getDVCCongDan(Long congdanId) {
		log.debug("Call get TblCongDan with: " + congdanId);
		TblCongDan object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblCongDan.class);
			criteria.add(Restrictions.eq("congDanId", congdanId));
			object = (TblCongDan)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblCongDan", e);
		}
		return object;
	}
	public Long countDVCCongDanAll() {
		// TODO Auto-generated method stub
		Long count = (long)0;
		org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
		Query query = session.createQuery("select count(*) from TblCongDan t where t.status = 1");
		count = ((Long)query.uniqueResult()).longValue();
		return count;
	}
	/**
	 * Lay thong tin Cong Dan theo page
	 * @param rowOfPage
	 * @param page
	 * @return
	 */
	public List<TblCongDan> getByPageDVCCongDan(int rowOfPage, int page) {
		log.debug("Call get List<TblCongDan>");
		List<TblCongDan> list = new ArrayList<TblCongDan>();
		if (rowOfPage <= 0) return list;
		if (page <= 0) return list;
		long totalPage = 0;
		try {
			long totalRecord = countDVCCongDanAll();
			totalPage = totalRecord/rowOfPage;
			if ((totalRecord%rowOfPage) > 0) {
				totalPage += 1;
			}
		} catch(Exception e) {}
		
		if (page > totalPage) page = 1;
		
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblCongDan.class);
			criteria.add(Restrictions.eq("status", (byte)1));
			criteria.addOrder(Order.desc("modified"));
			int firstResult = (page - 1)*rowOfPage;
			criteria.setFirstResult(firstResult);
			criteria.setMaxResults(rowOfPage);
			list = criteria.list();
		} catch (RuntimeException re) {
			log.error("get List<TblCongDan> failed", re);
		}
		return list;
	}
	
	public Long saveDvcCongDan(TblCongDan object) {
		log.debug("Call save TblCongDan");
		Long returnId = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			returnId = (Long)session.save(object);
			session.flush();
		} catch (Exception e) {
			log.debug("fail save TblCongDan", e);
		}
		return returnId;
	}
	public void updateDVCCongDang(TblCongDan object) throws Exception {
		log.debug("Call update TblCongDan");
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			session.update(object);
			session.flush();			
		} catch (Exception e) {
			log.debug("fail update TblCongDan", e);
			throw e;
		}
	}
	
	public String updateBatch(String arrCongDanId) {
		String sReturn = "";
		String[] congdanIds = arrCongDanId.split(",");
		log.debug("bmdtIds.length: " + congdanIds.length);
		for (int i = 0; i<congdanIds.length; i++) {
			Long congdanId = null;
			try {
				congdanId = Long.parseLong(congdanIds[i]);
			} catch (Exception e) {
				if (!"".equals(sReturn)) {
					sReturn = "\n";
				}
				sReturn = "congdanId = " + congdanIds[i] + " là không hợp lệ";
				congdanId = null;
			}
			if (congdanId != null) {
				TblCongDan bmdt = getDVCCongDan(congdanId);
				if (bmdt == null) {
					if (!"".equals(sReturn)) {
						sReturn = "\n";
					}
					sReturn = "congdanId là " + congdanIds[i] + " không tồn tại";
				} else {
					bmdt.setStatus((byte)3);
					Date current = new Date();
					bmdt.setModified(current);
					try {
						updateDVCCongDang(bmdt);
					} catch (Exception e) {
						if (!"".equals(sReturn)) {
							sReturn = "\n";
						}
						sReturn = "Lỗi phát sinh trong quá trình xóa congdanId: " + congdanIds[i];
					}
				}				
			}
		}	
		return sReturn;
	}
	//====================================================================================

	//TO chuc
	public TblToChuc getDVCToChu(Long toChucId) {
		log.debug("Call get TblToChuc with: " + toChucId);
		TblToChuc object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblToChuc.class);
			criteria.add(Restrictions.eq("toChucId", toChucId));
			object = (TblToChuc)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblToChuc", e);
		}
		return object;
	}
	
	//=====================================
	//Document

	//TO chuc
	public TblDocument getDVCDocument(Long documentId) {
		log.debug("Call get TblDocument with: " + documentId);
		TblDocument object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblDocument.class);
			criteria.add(Restrictions.eq("documentId", documentId));
			object = (TblDocument)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblDocument", e);
		}
		return object;
	}
	
	//xay dung co ban
	public TblTtcgcndkmsxdcb getDVCXDCB(Long ttcgcndkmsxdcbId) {
		log.debug("Call get TblTtcgcndkmsxdcb with: " + ttcgcndkmsxdcbId);
		TblTtcgcndkmsxdcb object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblTtcgcndkmsxdcb.class);
			criteria.add(Restrictions.eq("ttcgcndkmsxdcbId", ttcgcndkmsxdcbId));
			object = (TblTtcgcndkmsxdcb)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblTtcgcndkmsxdcb", e);
		}
		return object;
	}
		
	/**
	 * Thông tin cap ma so 
	 * @param ttcmsdvsdnsId
	 * @return Oject
	 */
	public TblTtcmsdvsdns getDVCXCapMaSo(Long ttcmsdvsdnsId) {
		log.debug("Call get TblTtcmsdvsdns with: " + ttcmsdvsdnsId);
		TblTtcmsdvsdns object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblTtcmsdvsdns.class);
			criteria.add(Restrictions.eq("ttcmsdvsdnsId", ttcmsdvsdnsId));
			object = (TblTtcmsdvsdns)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblTtcmsdvsdns", e);
		}
		return object;
	}
	
	/**
	 * Lấy thông tin bổ sung ngân sách
	 * @param ttpapbdtnsId
	 * @return
	 */
	public TblTtpapbdtns getDVCPhanBoNganSach(Long ttpapbdtnsId) {
		log.debug("Call get TblTtpapbdtns with: " + ttpapbdtnsId);
		TblTtpapbdtns object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblTtpapbdtns.class);
			criteria.add(Restrictions.eq("ttpapbdtnsId", ttpapbdtnsId));
			object = (TblTtpapbdtns)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblTtpapbdtns", e);
		}
		return object;
	}
	
	/**
	 * Lấy thông tin bổ sung ngân sách
	 * @param ttpapbdtnsId
	 * @return
	 */
	public TblTtpdgmsts getDVCThamTraMuaSamTaiSan(Long ttpdgmstsId) {
		log.debug("Call get TblTtpdgmsts with: " + ttpdgmstsId);
		TblTtpdgmsts object = null;
		try {
			org.hibernate.Session session = vn.softech.hibernate.HibernateSessionFactory.getSession();
			Criteria criteria = session.createCriteria(TblTtpdgmsts.class);
			criteria.add(Restrictions.eq("ttpdgmstsId", ttpdgmstsId));
			object = (TblTtpdgmsts)criteria.list().get(0);
		} catch (Exception e) {
			log.debug("fail get TblTtpdgmsts", e);
		}
		return object;
	}
}
